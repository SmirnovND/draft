# üîç Staticlint - –ö–∞—Å—Ç–æ–º–Ω—ã–π Multichecker

–ö–∞—Å—Ç–æ–º–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–¥–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ `golang.org/x/tools/go/analysis/multichecker`.

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

Staticlint –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–æ–≤ –¥–ª—è –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞:
- –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –±–∞–≥–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∏–ª—è –∫–æ–¥–∞
- –ü–æ–∏—Å–∫ –ø—Ä–æ–±–ª–µ–º —Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é
- –í—ã—è–≤–ª–µ–Ω–∏–µ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–π

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ß–µ—Ä–µ–∑ Makefile (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
make lint
```

### –ù–∞–ø—Ä—è–º—É—é

```bash
go run ./cmd/staticlint/main.go ./...
```

### –î–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–∞–∫–µ—Ç–∞

```bash
go run ./cmd/staticlint/main.go ./internal/repositories
```

## üìã –í–∫–ª—é—á–µ–Ω–Ω—ã–µ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä—ã

### 1. –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä—ã (golang.org/x/tools)

| –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|----------|
| `printf` | –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç—Ä–æ–∫ –≤ —Ñ—É–Ω–∫—Ü–∏—è—Ö —Ç–∏–ø–∞ Printf |
| `shadow` | –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∑–∞—Ç–µ–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö |
| `structtag` | –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —Ç–µ–≥–æ–≤ —Å—Ç—Ä—É–∫—Ç—É—Ä (json, db, xml –∏ —Ç.–¥.) |
| `unreachable` | –ü–æ–∏—Å–∫ –Ω–µ–¥–æ—Å—Ç–∏–∂–∏–º–æ–≥–æ –∫–æ–¥–∞ |

### 2. Staticcheck SA (–ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –±–∞–≥–∏)

–í—Å–µ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ **SA** –∏–∑ [staticcheck.io](https://staticcheck.io/docs/checks):

- `SA1000` - `SA1030`: –ü—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
- `SA2000` - `SA2003`: –ü—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã —Å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å—é
- `SA3000` - `SA3001`: –ü—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã —Å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- `SA4000` - `SA4031`: –ü—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏
- `SA5000` - `SA5012`: –ü—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —è–∑—ã–∫–æ–≤—ã—Ö –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–π
- `SA6000` - `SA6005`: –ü—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é
- `SA9000` - `SA9008`: –ü—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –∏ –¥—Ä—É–≥–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

**–ü—Ä–∏–º–µ—Ä—ã:**
- `SA1019` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ deprecated —Ñ—É–Ω–∫—Ü–∏–π
- `SA4006` - –ø—Ä–∏—Å–≤–∞–∏–≤–∞–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π, –∫–æ—Ç–æ—Ä–∞—è –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
- `SA5007` - –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ —Ä–µ–∫—É—Ä—Å–∏–∏

### 3. Staticcheck ST1000

- `ST1000` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è –ø–∞–∫–µ—Ç–æ–≤ (–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å lowercase –±–µ–∑ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–π)

### 4. –ü—É–±–ª–∏—á–Ω—ã–µ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä—ã

| –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä | –û–ø–∏—Å–∞–Ω–∏–µ | –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π |
|------------|----------|-------------|
| `nilerr` | –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫ (–≤–æ–∑–≤—Ä–∞—Ç nil –≤–º–µ—Å—Ç–æ err) | [gostaticanalysis/nilerr](https://github.com/gostaticanalysis/nilerr) |
| `bodyclose` | –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è `http.Response.Body` | [timakin/bodyclose](https://github.com/timakin/bodyclose) |

### 5. –ö–∞—Å—Ç–æ–º–Ω—ã–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä

#### exitchecker

–ó–∞–ø—Ä–µ—â–∞–µ—Ç –ø—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã `os.Exit()` –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `main` –ø–∞–∫–µ—Ç–∞ `main`.

**–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ:**
- `os.Exit()` –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –∑–∞–≤–µ—Ä—à–∞–µ—Ç –ø—Ä–æ–≥—Ä–∞–º–º—É, –º–∏–Ω—É—è defer-—Ñ—É–Ω–∫—Ü–∏–∏
- –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —É—Ç–µ—á–∫–∞–º —Ä–µ—Å—É—Ä—Å–æ–≤ –∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–º—É –∑–∞–≤–µ—Ä—à–µ–Ω–∏—é
- –õ—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `return` —Å –∫–æ–¥–æ–º –æ—à–∏–±–∫–∏

**–ü–ª–æ—Ö–æ:**
```go
func main() {
    if err := run(); err != nil {
        log.Fatal(err)
        os.Exit(1) // ‚ùå –ë—É–¥–µ—Ç –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ
    }
}
```

**–•–æ—Ä–æ—à–æ:**
```go
func main() {
    if err := run(); err != nil {
        log.Fatal(err) // ‚úÖ log.Fatal —Å–∞–º –≤—ã–∑—ã–≤–∞–µ—Ç os.Exit
        return
    }
}
```

## üìä –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞

```
Enabled analyzers:
printf
shadow
structtag
unreachable
SA1000
SA1001
...
ST1000
nilerr
bodyclose
exitchecker

internal/repositories/user_repository.go:45:2: 
  this value of err is never used (SA4006)
internal/controllers/user_controller.go:78:15: 
  response body must be closed (bodyclose)
cmd/server/main.go:25:5: 
  direct call to os.Exit in main is not allowed (exitchecker)
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `cmd/staticlint/main.go`:

```go
import "your/analyzer/package"

func main() {
    // ...
    analyzers = append(analyzers, youranalyzer.Analyzer)
    // ...
}
```

### –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞

–ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –∏–ª–∏ —É–¥–∞–ª–∏—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é —Å—Ç—Ä–æ–∫—É –≤ `main.go`.

### –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞

1. –°–æ–∑–¥–∞–π—Ç–µ –ø–∞–∫–µ—Ç –≤ `cmd/staticlint/youranalyzer/`
2. –†–µ–∞–ª–∏–∑—É–π—Ç–µ `analysis.Analyzer`
3. –î–æ–±–∞–≤—å—Ç–µ –≤ —Å–ø–∏—Å–æ–∫ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–æ–≤ –≤ `main.go`

**–ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:**

```go
package youranalyzer

import "golang.org/x/tools/go/analysis"

var Analyzer = &analysis.Analyzer{
    Name: "youranalyzer",
    Doc:  "description of your analyzer",
    Run:  run,
}

func run(pass *analysis.Pass) (interface{}, error) {
    // –í–∞—à–∞ –ª–æ–≥–∏–∫–∞ –∞–Ω–∞–ª–∏–∑–∞
    return nil, nil
}
```

## üéì –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [Writing Go analysis passes](https://pkg.go.dev/golang.org/x/tools/go/analysis)
- [Staticcheck documentation](https://staticcheck.io/docs/)
- [Go AST Viewer](https://yuroyoro.github.io/goast-viewer/) - –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è AST

## üí° –°–æ–≤–µ—Ç—ã

1. **–ó–∞–ø—É—Å–∫–∞–π—Ç–µ —Ä–µ–≥—É–ª—è—Ä–Ω–æ**: –î–æ–±–∞–≤—å—Ç–µ `make lint` –≤ CI/CD pipeline
2. **–ò—Å–ø—Ä–∞–≤–ª—è–π—Ç–µ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ**: –ù–∞—á–Ω–∏—Ç–µ —Å –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ—à–∏–±–æ–∫ (SA –∫–∞—Ç–µ–≥–æ—Ä–∏—è)
3. **–ò–∑—É—á–∞–π—Ç–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è**: –ö–∞–∂–¥–æ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ - –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–ª—É—á—à–∏—Ç—å –∫–æ–¥
4. **–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–π—Ç–µ –ø–æ–¥ –ø—Ä–æ–µ–∫—Ç**: –û—Ç–∫–ª—é—á–∞–π—Ç–µ –Ω–µ–∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä—ã

## üêõ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- –ê–Ω–∞–ª–∏–∑ –º–æ–∂–µ—Ç –∑–∞–Ω–∏–º–∞—Ç—å –≤—Ä–µ–º—è –Ω–∞ –±–æ–ª—å—à–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö
- –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç –¥–∞–≤–∞—Ç—å –ª–æ–∂–Ω—ã–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è
- –ù–µ –≤—Å–µ –ø—Ä–æ–±–ª–µ–º—ã –º–æ–≥—É—Ç –±—ã—Ç—å –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–º –∞–Ω–∞–ª–∏–∑–æ–º

## üìù –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å IDE

### GoLand / IntelliJ IDEA

1. Settings ‚Üí Tools ‚Üí File Watchers
2. –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π watcher –¥–ª—è `.go` —Ñ–∞–π–ª–æ–≤
3. Program: `make`
4. Arguments: `lint`

### VS Code

–î–æ–±–∞–≤—å—Ç–µ –≤ `.vscode/tasks.json`:

```json
{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "lint",
      "type": "shell",
      "command": "make lint",
      "group": "test"
    }
  ]
}
```

---

**–°–æ–∑–¥–∞–Ω–æ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –≤—ã—Å–æ–∫–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞ –≤ Go –ø—Ä–æ–µ–∫—Ç–∞—Ö** üöÄ